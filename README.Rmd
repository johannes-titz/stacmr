---
output: github_document
---

<!-- README.md is generated from README.Rmd. Please edit that file -->

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>",
  fig.path = "man/figures/README-",
  out.width = "100%"
)
```
# stacmr

<!-- badges: start -->
[![R-CMD-check](https://github.com/monotonicity/stacmr/actions/workflows/R-CMD-check.yaml/badge.svg)](https://github.com/monotonicity/stacmr/actions/workflows/R-CMD-check.yaml)
[![Codecov test coverage](https://codecov.io/gh/monotonicity/stacmr/graph/badge.svg)](https://app.codecov.io/gh/monotonicity/stacmr)
<!-- badges: end -->

The goal of `stacmr` is to provide functionality for state-trace analysis via conjoint monotonic regression. The main function for this is `cmr()`. In addition, it provides functionality for fitting monotonic regression models with function `mr()`.

## Installation

You can install the released version of stacmr from [CRAN](https://CRAN.R-project.org) with:

``` r
## NOT YET AVAILABLE FROM CRAN
```

And the development version from [GitHub](https://github.com/) with:

``` r
# install.packages("devtools")
devtools::install_github("monotonicity/stacmr")
```
## Example

This is a basic example.

```{r example}
library(stacmr)
## load data from Exp. 1 of Dunn, Newell, & Kalish (2012)
data(delay)
str(delay, width = 78, strict.width = "cut")

stats <- sta_stats(
  data = delay, 
  col_value = "pc", 
  col_participant = "participant",
  col_dv = "structure", 
  col_within = "block", 
  col_between = "delay"
)
stats


### cmr() fits conjoint monotonic regression for state-trace analysis
## Fit and test CMR State-Trace Analysis Model
st_d1 <- cmr(
  data = delay, 
  col_value = "pc", 
  col_participant = "participant",
  col_dv = "structure", 
  col_within = "block", 
  col_between = "delay", 
  nsample = 1e4
)
st_d1  ## basic information about conjoint-monotonic model

summary(st_d1)  ## basic information plus estimated cell means

### cmr() also accepts partial order. 
## CMR model is tested against MR model with partial order 
st_d3 <- cmr(
  data = delay, 
  col_value = "pc", 
  col_participant = "participant",
  col_dv = "structure", 
  col_within = "block", 
  col_between = "delay", 
  partial = "auto"
)
st_d3
summary(st_d3)
```


## Changes to upstream JT

- singmann changes are starting on may 24, 2019
- kalish repo last change before that is on february 28, 2019
- kalish repo had changes made after may 24, 2019

The only file that was massively chaned is gen2list.R, which is basically a rewrite. 

Otherwise we can just take the upstream files. As far as I can see, the cahnges were cosmetic, mainly returning more information in the output (e.g. bootstrap means), although one change appears to be a bug fix, where nCond is changed from length(y[[1]][[1]] to length(y[[1]][[1]][1,])), but that seems to be for list-inputs, not for data-frames.

what is missing in stacmr is staCMRFIT.R (testing the difference between fits of monotonic model and partial order model) and staMRFIT.R (testing the fit of a partial order), which are replaced by cmr and mr, respectively in continuous_state-trace.R. So changes in staCMRFIT.R and staMRFIT.R must be tracked carefully. The changes to date included adding `pars` to the output, that's it.

## todos JT

What is generally missing in stacmr is a wrapper for binomial data. This is currently in the dunn & kalish format in the files that include BN.

in the upstream code pars argument is missing in jMRfits.R -> this is is definitely an issue that should be filed in STA

we need to think about maintaining the code...is it better to rely on upstream R wrappers or on own R wrappers? if there are any changes to upstream code, it might be a mess to integrate them, then again the original wrappers are not ideal anyway.

can we get this on cran with java binaries? or building on cran with maven?